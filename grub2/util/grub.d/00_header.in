#! /bin/sh -e

# update-grub helper script.
# Copyright (C) 2006, 2007 Free Software Foundation, Inc.
#
# This file is free software; you can redistribute it and/or modify it
# under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St - Suite 330, Boston, MA 02110, USA.

prefix=@prefix@
exec_prefix=@exec_prefix@
libdir=@libdir@

# for convert_system_path_to_grub_path()
. ${libdir}/grub/update-grub_lib

if [ "x${GRUB_DEFAULT}" = "x" ] ; then GRUB_DEFAULT=0 ; fi
if [ "x${GRUB_TIMEOUT}" = "x" ] ; then GRUB_TIMEOUT=5 ; fi

cat << EOF
set default=${GRUB_DEFAULT}
set timeout=${GRUB_TIMEOUT}
EOF

if [ "x${GRUB_DRIVE}" = "x" ] ; then : ; else
  cat << EOF
set root=${GRUB_DRIVE}
EOF
fi

# Prefer system path for space reasons (/boot/grub might be a very small
# partition in case of OpenFirmware, etc).
for i in /usr/share/grub/unifont.pff /boot/grub/unifont.pff ; do
  if grub_path=`convert_system_path_to_grub_path $i` ; then
    cat << EOF

font ${grub_path}
set gfxmode=640x480
insmod gfxterm
insmod vbe
terminal gfxterm
EOF
    break
  fi
done
